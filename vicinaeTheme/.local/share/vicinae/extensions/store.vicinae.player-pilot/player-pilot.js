"use strict";var g=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var k=(s,e)=>{for(var n in e)g(s,n,{get:e[n],enumerable:!0})},L=(s,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of I(e))!C.call(s,o)&&o!==n&&g(s,o,{get:()=>e[o],enumerable:!(r=b(e,o))||r.enumerable});return s};var R=s=>L(g({},"__esModule",{value:!0}),s);var T={};k(T,{default:()=>N});module.exports=R(T);var a=require("@vicinae/api"),f=require("react");var h=require("node:child_process"),w=require("node:util"),m=(0,w.promisify)(h.exec);async function v(s){try{let n=(await m(`playerctl --player ${s} metadata`)).stdout.split(`
`).map(t=>t.split(" ").filter(c=>c.length>=1)),r={};r.player=n[0][0];for(let t of n)if(t[1]==="xesam:title")r.title=t.slice(2).join(" ");else if(t[1]==="xesam:album")r.album=t.slice(2).join(" ");else if(t[1]==="xesam:artist")r.artist=t.slice(2).join(" ");else if(t[1]==="mpris:artUrl")r.albumArt=t.slice(2).join(" ");else if(t[1]==="mpris:length"){let c=parseInt(t[2],10),u=Math.floor(c/6e7),P=c%6e7,M=Math.floor(P/1e6);r.songLength=`${u}:${String(M).padStart(2,"0")}`}let o=await m(`playerctl --player ${s} position`),i=Math.floor(parseFloat(o.stdout)),y=Math.floor(i/60),d=i%60;r.position=`${y}:${String(d).padStart(2,"0")}`;let p=await m(`playerctl --player ${s} status`);return r.paused=p.stdout!=="Playing",r}catch(e){if(e instanceof Error&&e.message.includes("No players found"))return console.warn("No media players found. Make sure a media player is running."),null;throw e}}function E(s){let e="",n=s.split(".");return n.length===3?e=n[1]:e=n[0],e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}async function $(s){try{let n=(await m("playerctl --list-all")).stdout.trim().split(`
`).filter(i=>i.length>0);if(n.length===0)return[];let r;if(s===void 0?r=n:r=n.filter(i=>s.some(y=>i.toLowerCase().includes(y.toLowerCase())||y.toLowerCase().includes(i.toLowerCase()))),r.length===0)return console.warn(`No players found matching preference: ${s}`),[];let o=[];for(let i of r)try{let d=(await m(`playerctl --player ${i} status`)).stdout.trim(),p=E(i),t=null;(d==="Playing"||d==="Paused")&&(t=await v(i)),o.push({name:i,displayName:p,status:d,metadata:t})}catch(y){console.warn(`Failed to get info for player ${i}:`,y)}return o.sort((i,y)=>{let d={Playing:0,Paused:1,Stopped:2};return d[i.status]-d[y.status]})}catch(e){if(e instanceof Error&&e.message.includes("No players found"))return console.warn("No media players found. Make sure a media player is running."),[];throw e}}async function x(s,e){try{e!==void 0?await m(`playerctl --player ${e} ${s}`):await m(`playerctl --all-players ${s}`)}catch(n){if(n.stderr?.startsWith("No players found"))return;throw n}}var S=require("@vicinae/api");function A(){let e=(0,S.getPreferenceValues)()["playerctl-players"];if(!(e==="%any"||e.trim()===""))return e.split(",").map(n=>n.trim())}var l=require("react/jsx-runtime");function N(){let[s,e]=(0,f.useState)([]),[n,r]=(0,f.useState)(!0),[o,i]=(0,f.useState)(null),[y,d]=(0,f.useState)(2);(0,f.useEffect)(()=>{let t;async function c(){try{let u=await $(A());e(u),u.length<=2?d(2):d(3),u.length>0&&!o&&i(u[0].displayName)}catch(u){console.error("Failed to load players",u)}finally{r(!1)}}return c(),t=setInterval(c,2e3),()=>clearInterval(t)},[o]);let p=async(t,c)=>{let u=c.charAt(0).toUpperCase()+c.slice(1);try{await x(c,t.name)}catch{(0,a.showToast)(a.Toast.Style.Failure,`Failed to ${u} on ${t.displayName}`);return}(0,a.showToast)(a.Toast.Style.Success,`${u} executed on ${t.displayName}`)};return n?(0,l.jsx)(a.Grid,{searchBarPlaceholder:"Search players...",children:(0,l.jsx)(a.Grid.EmptyView,{title:"Loading Players",description:"Please wait while we load your media players...",icon:a.Icon.Clock})}):s.length===0?(0,l.jsx)(a.Grid,{searchBarPlaceholder:"Search players...",children:(0,l.jsx)(a.Grid.EmptyView,{title:"No Media Players Found",description:"Make sure a media player is running and try again",icon:a.Icon.Music})}):(0,l.jsx)(a.Grid,{searchBarPlaceholder:"Search players...",columns:y,aspectRatio:"3/2",inset:a.Grid.Inset.Small,navigationTitle:o?`Players - ${o}`:"Media Players",onSelectionChange:i,children:(0,l.jsx)(a.Grid.Section,{title:"Media Players",columns:y,aspectRatio:"3/2",inset:a.Grid.Inset.Small,children:s.map(t=>{let c=t.metadata?.artist?`${t.metadata.artist} - ${t.metadata.album??"Unknown"}`:t.status,u=t.metadata?.title?`- ${t.metadata.title}`:"",P=`${t.status==="Playing"?"\u25B6\uFE0F":"\u23F8\uFE0F"} ${t.displayName} ${u}`;return(0,l.jsx)(a.Grid.Item,{id:t.displayName,title:P,subtitle:c,content:t.metadata?.albumArt||a.Icon.Music,actions:(0,l.jsxs)(a.ActionPanel,{children:[(0,l.jsx)(a.Action,{title:t.status==="Playing"?"Pause":"Play",icon:t.status==="Playing"?a.Icon.Pause:a.Icon.Play,onAction:()=>p(t,t.status==="Playing"?"pause":"play")}),(0,l.jsx)(a.Action,{title:t.status==="Playing"?"Next":"Play Next",icon:a.Icon.Forward,onAction:()=>p(t,"next")}),(0,l.jsx)(a.Action,{title:t.status==="Playing"?"Previous":"Play Previous",icon:a.Icon.Rewind,onAction:()=>p(t,"previous")}),(0,l.jsx)(a.Action,{title:"Stop",icon:a.Icon.Stop,onAction:()=>p(t,"stop")})]})},t.name)})})})}
